
{% extends 'template/base.html' %}

{% block content %}
    <h1>{% block title %}Posts{% endblock %}</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul class="flashes">
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
    
    {% for post in posts %}
        <div class='post' style="border: 1px solid #ddd; padding: 10px; margin-bottom: 20px; border-radius: 5px;">
            <p><strong>Posted on:</strong> {{ post['created'] }}</p>
            <h2>{{ post['title'] }} (ID: {{ post['id'] }})</h2>
            <p>{{ post['content'] }}</p>

            {% if post['image_url'] %}
                {% set file_extension = post['image_url'].split('.')[-1].lower() %}
                {% if file_extension in ['jpg', 'jpeg', 'png', 'gif'] %}
                    <img src="{{ url_for('uploaded_file', filename=post['image_url'].split('/')[-1]) }}" 
                         alt="Post Image" 
                         class="post-image"
                         style="max-width:100%; height:auto; margin: 10px 0;"
                         onerror="this.onerror=null; this.src='{{ url_for('static', filename='images/default.jpg') }}';">
                {% elif file_extension == 'pdf' %}
                    <p>
                        <a href="{{ url_for('uploaded_file', filename=post['image_url'].split('/')[-1]) }}" target="_blank">
                            View PDF
                        </a>
                    </p>
                {% else %}
                    <p>
                        <a href="{{ url_for('uploaded_file', filename=post['image_url'].split('/')[-1]) }}" target="_blank">
                            Download File
                        </a>
                    </p>
                {% endif %}
            {% else %}
                <p>No file attached to this post.</p>
            {% endif %}
            
            <a href="{{ url_for('edit', id=post['id']) }}" class="btn btn-primary">Edit</a>
            <form action="{{ url_for('delete', id=post['id']) }}" method="POST" style="display:inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this post?');">Delete</button>
            </form>
        </div>
    {% endfor %}
{% endblock %}
